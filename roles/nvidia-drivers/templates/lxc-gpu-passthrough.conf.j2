# NVIDIA GPU passthrough configuration for LXC containers
# This file configures kernel modules and device access for GPU passthrough

# NVIDIA kernel modules
{% for module in nvidia_modules %}
{{ module }}
{% endfor %}

# Device access rules for LXC containers
# Add these to your LXC container configuration:
#
# For Ollama LXC container, add to /etc/pve/lxc/<VMID>.conf:
{% for device in lxc_gpu_devices %}
# lxc.cgroup2.devices.allow: {{ device }}
{% endfor %}
#
# Also add device mappings:
# lxc.mount.entry: /dev/nvidia0 dev/nvidia0 none bind,optional,create=file
# lxc.mount.entry: /dev/nvidiactl dev/nvidiactl none bind,optional,create=file
# lxc.mount.entry: /dev/nvidia-uvm dev/nvidia-uvm none bind,optional,create=file
# lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-uvm-tools none bind,optional,create=file
# lxc.mount.entry: /dev/nvidia-modeset dev/nvidia-modeset none bind,optional,create=file

# NVIDIA driver options for optimal LXC performance
options nvidia NVreg_DeviceFileUID=0 NVreg_DeviceFileGID=0 NVreg_DeviceFileMode=0666